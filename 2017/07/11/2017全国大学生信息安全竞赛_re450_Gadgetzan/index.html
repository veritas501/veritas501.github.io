<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">










<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="这道题从我开始看到做出差不多花了8,9个小时，已经是我做过最复杂的逆向了（其中部分还在大佬的帮助下）。没有大佬的帮助，我肯定是做不出的，在此先感谢一下。 写这篇文章的主要目的是为了记录，算是我逆向路上的一个新的里程碑吧。 程序下载：Gadgetzan，patch时间的版本：Gadgetzan_patchtime。 为了方便理解，我附上我的idb文件：Gadgetzan.idb">
<meta name="keywords" content="RE">
<meta property="og:type" content="article">
<meta property="og:title" content="2017全国大学生信息安全竞赛 re450 Gadgetzan">
<meta property="og:url" content="https://veritas501.github.io/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/index.html">
<meta property="og:site_name" content="Veritas501&#39;s Blog">
<meta property="og:description" content="这道题从我开始看到做出差不多花了8,9个小时，已经是我做过最复杂的逆向了（其中部分还在大佬的帮助下）。没有大佬的帮助，我肯定是做不出的，在此先感谢一下。 写这篇文章的主要目的是为了记录，算是我逆向路上的一个新的里程碑吧。 程序下载：Gadgetzan，patch时间的版本：Gadgetzan_patchtime。 为了方便理解，我附上我的idb文件：Gadgetzan.idb">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_b41aacc79c09004ab3fd4a6859119312.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_0ddd4accc280fa33a0959a4f8dd318be.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_3d055889d047898a7cfaa326015b70d1.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_de22372716d5c74d546e89a15bd3688f.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_cff99f1103b06559e2abd48b65850751.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_cb441cc1323e73e48d21e8be0d5d0978.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_06f33c245df3b058926139cd629b1ff1.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_3365d2a09163bbacd869e2e07bfb563d.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_0c80f7c4070428f4eeb29137f1252568.png">
<meta property="og:image" content="http://img2.tan90.me/gadgetzan_6653524b660df35ebd791d2b2495c417.png">
<meta property="og:updated_time" content="2018-09-20T06:34:26.022Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2017全国大学生信息安全竞赛 re450 Gadgetzan">
<meta name="twitter:description" content="这道题从我开始看到做出差不多花了8,9个小时，已经是我做过最复杂的逆向了（其中部分还在大佬的帮助下）。没有大佬的帮助，我肯定是做不出的，在此先感谢一下。 写这篇文章的主要目的是为了记录，算是我逆向路上的一个新的里程碑吧。 程序下载：Gadgetzan，patch时间的版本：Gadgetzan_patchtime。 为了方便理解，我附上我的idb文件：Gadgetzan.idb">
<meta name="twitter:image" content="http://img2.tan90.me/gadgetzan_b41aacc79c09004ab3fd4a6859119312.png">






  <link rel="canonical" href="https://veritas501.github.io/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>2017全国大学生信息安全竞赛 re450 Gadgetzan | Veritas501's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Veritas501's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-guestbook">
    <a href="/Guestbook" rel="section">
      <i class="menu-item-icon fa fa-fw fa-pencil"></i> <br />Guestbook</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://veritas501.github.io/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Veritas501">
      <meta itemprop="description" content="开始踏上Re&Pwn之路...">
      <meta itemprop="image" content="/images/215.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Veritas501's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">2017全国大学生信息安全竞赛 re450 Gadgetzan
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-07-11 00:00:00" itemprop="dateCreated datePublished" datetime="2017-07-11T00:00:00+08:00">2017-07-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-20 14:34:26" itemprop="dateModified" datetime="2018-09-20T14:34:26+08:00">2018-09-20</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/" class="leancloud_visitors" data-flag-title="2017全国大学生信息安全竞赛 re450 Gadgetzan">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views: </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>这道题从我开始看到做出差不多花了8,9个小时，已经是我做过最复杂的逆向了（其中部分还在大佬的帮助下）。没有大佬的帮助，我肯定是做不出的，在此先感谢一下。</p>
<p>写这篇文章的主要目的是为了记录，算是我逆向路上的一个新的里程碑吧。</p>
<p>程序下载：<a href="https://raw.githubusercontent.com/veritas501/attachment_in_blog/master/Gadgetzan/Gadgetzan" target="_blank" rel="noopener">Gadgetzan</a>，patch时间的版本：<a href="https://raw.githubusercontent.com/veritas501/attachment_in_blog/master/Gadgetzan/Gadgetzan_patchtime" target="_blank" rel="noopener">Gadgetzan_patchtime</a>。</p>
<p>为了方便理解，我附上我的idb文件：<a href="https://raw.githubusercontent.com/veritas501/attachment_in_blog/master/Gadgetzan/Gadgetzan.idb" target="_blank" rel="noopener">Gadgetzan.idb</a></p>
<a id="more"></a>
<hr>
<p>首先跟着字符串来到我们的主函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">start_here</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// ecx@2</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax@3</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// [sp-Eh] [bp-2Ch]@0</span></span><br><span class="line">  <span class="keyword">int</span> input; <span class="comment">// [sp+1h] [bp-1Dh]@1</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [sp+5h] [bp-19h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [sp+9h] [bp-15h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [sp+Dh] [bp-11h]@1</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [sp+11h] [bp-Dh]@1</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [sp+12h] [bp-Ch]@1</span></span><br><span class="line">  <span class="keyword">int</span> *v10; <span class="comment">// [sp+1Ah] [bp-4h]@1</span></span><br><span class="line"></span><br><span class="line">  v10 = &amp;a1;</span><br><span class="line">  v9 = *MK_FP(__GS__, <span class="number">20</span>);</span><br><span class="line">  <span class="built_in">puts</span>((<span class="keyword">int</span>)<span class="string">"Welcome to Gadgetzan!~"</span>);</span><br><span class="line">  sub_8071770(<span class="number">1</span>, (<span class="keyword">int</span>)<span class="string">"Show me your key:"</span>, v3);</span><br><span class="line">  input = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%16s"</span>, &amp;input);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="keyword">int</span>)&amp;input) == <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    enc_func1((<span class="keyword">char</span> *)&amp;input);                  <span class="comment">// chag_input</span></span><br><span class="line">    enc_func2((BYTE *)&amp;input);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>((<span class="keyword">int</span>)<span class="string">"Key length error!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *MK_FP(__GS__, <span class="number">20</span>) != v9 )</span><br><span class="line">    canary(v1, *MK_FP(__GS__, <span class="number">20</span>) ^ v9);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得知<strong>input长度为16</strong>，且加密分在了两个函数内，就是这里的<code>enc_func1</code>和<code>enc_func2</code>。<br>func1先大致看了一眼，是将输入的字符串加密成等长（16bytes）的字符串，我们叫他<code>chg_ipt</code>。</p>
<hr>
<p>我们看func2，毕竟逆向是倒推的过程。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">enc_func2</span><span class="params">(BYTE *chg_ipt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  BYTE _R; <span class="comment">// bl@1</span></span><br><span class="line">  BYTE *ptr; <span class="comment">// eax@1</span></span><br><span class="line">  _BYTE *ptr_2; <span class="comment">// esi@1</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> L; <span class="comment">// eax@1</span></span><br><span class="line">  <span class="keyword">int</span> k; <span class="comment">// ecx@2</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v6; <span class="comment">// eax@4</span></span><br><span class="line">  BYTE *ptr_3; <span class="comment">// esi@7</span></span><br><span class="line">  _WORD *check_p; <span class="comment">// ebp@7</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// edi@7</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> val; <span class="comment">// edx@7</span></span><br><span class="line">  <span class="keyword">int</span> tmp_i; <span class="comment">// ecx@8</span></span><br><span class="line">  <span class="keyword">int</span> ck_WORD; <span class="comment">// ebx@8</span></span><br><span class="line">  <span class="keyword">int</span> ptr_v; <span class="comment">// eax@10</span></span><br><span class="line">  __int16 check_v; <span class="comment">// ax@13</span></span><br><span class="line">  BYTE R; <span class="comment">// [sp+16h] [bp-36h]@2</span></span><br><span class="line">  __int16 Ra; <span class="comment">// [sp+16h] [bp-36h]@7</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> ipt_L; <span class="comment">// [sp+18h] [bp-34h]@2</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> ipt_R; <span class="comment">// [sp+1Ch] [bp-30h]@2</span></span><br><span class="line">  <span class="keyword">int</span> n; <span class="comment">// [sp+20h] [bp-2Ch]@1</span></span><br><span class="line">  BYTE *tbl; <span class="comment">// [sp+24h] [bp-28h]@1</span></span><br><span class="line">  BYTE *ptr_1; <span class="comment">// [sp+2Ch] [bp-20h]@1</span></span><br><span class="line"></span><br><span class="line">  _R = <span class="number">88</span>;</span><br><span class="line">  ptr = (BYTE *)<span class="built_in">calloc</span>(<span class="number">256</span>, <span class="number">1u</span>);</span><br><span class="line">  ptr_1 = ptr;</span><br><span class="line">  tbl = (BYTE *)&amp;bfr_tbl[<span class="number">8</span>];                    <span class="comment">// 定值</span></span><br><span class="line">  ptr_2 = ptr;</span><br><span class="line">  L = <span class="number">54</span>;</span><br><span class="line">  n = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )                                   <span class="comment">// PART1</span></span><br><span class="line">  &#123;</span><br><span class="line">    R = _R;</span><br><span class="line">    ipt_L = chg_ipt[n];</span><br><span class="line">    k = <span class="number">0</span>;</span><br><span class="line">    ipt_R = chg_ipt[-n + <span class="number">15</span>];</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ptr_2[L] = (ipt_L &gt;&gt; k) &amp; <span class="number">1</span>;</span><br><span class="line">      v6 = ipt_R &gt;&gt; k++;</span><br><span class="line">      ptr_2[R] = v6 &amp; <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( k == <span class="number">8</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      L = (<span class="keyword">unsigned</span> __int8)*(&amp;bfr_tbl[<span class="number">8</span> * n] + k);</span><br><span class="line">      R = *(&amp;tbl[k] + <span class="number">120</span> - (_DWORD)bfr_tbl + (_DWORD)bfr_tbl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( ++n == <span class="number">16</span> )                            <span class="comment">// 最终出while的条件</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    L = *tbl;</span><br><span class="line">    _R = tbl[<span class="number">128</span>];</span><br><span class="line">    tbl += <span class="number">8</span>;</span><br><span class="line">  &#125;                                             <span class="comment">// PART2</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">  ptr_3 = ptr_1;</span><br><span class="line">  check_p = &amp;check_start;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  val = <span class="number">0xFFFF8EBC</span>;</span><br><span class="line">  <span class="keyword">for</span> ( Ra = <span class="number">0x86C1</span>u; ; Ra = check_v )</span><br><span class="line">  &#123;</span><br><span class="line">    tmp_i = <span class="number">0</span>;</span><br><span class="line">    ck_WORD = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ptr_v = ptr_3[<span class="number">8</span> * tmp_i];</span><br><span class="line">      tmp_i += <span class="number">2</span>;</span><br><span class="line">      ck_WORD ^= ptr_v * val;</span><br><span class="line">      <span class="keyword">if</span> ( tmp_i == <span class="number">0x20</span> )                      <span class="comment">// 0x10次</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      val = *(_WORD *)((<span class="keyword">char</span> *)&amp;check_end + <span class="number">2</span> * i + tmp_i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( (_WORD)ck_WORD != Ra )</span><br><span class="line">      <span class="keyword">break</span>;                                    <span class="comment">// wrong</span></span><br><span class="line">    ++ptr_3;</span><br><span class="line">    i += <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">if</span> ( check_p == &amp;check_end )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>((<span class="keyword">int</span>)<span class="string">"Good job! The flag is your input..."</span>);</span><br><span class="line">      sub_804A470((<span class="keyword">int</span>)ptr_1);</span><br><span class="line">      <span class="built_in">free</span>((<span class="keyword">int</span>)ptr_1);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    check_v = *check_p;</span><br><span class="line">    val = *(&amp;check_end + i);</span><br><span class="line">    ++check_p;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>((<span class="keyword">int</span>)<span class="string">"Wrong key!"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>func2分为PART1和PART2，PART1是将输入的字符串的每一bit按照某个box打乱，放在一个16*16的内存中，内存里看大概是这样的</p>
<p><img src="http://img2.tan90.me/gadgetzan_b41aacc79c09004ab3fd4a6859119312.png" alt=""></p>
<p>由于从左到右和从右到左，每1bit被放了两遍，所以一共有8*16*2 = 16*16 = 256。</p>
<p>用于随机的box</p>
<p><img src="http://img2.tan90.me/gadgetzan_0ddd4accc280fa33a0959a4f8dd318be.png" alt=""></p>
<p>伪算法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>*<span class="number">8</span>):</span><br><span class="line">	L = box[i]</span><br><span class="line">	R = box[i+<span class="number">0x80</span>]</span><br><span class="line">	bits_stream_L = fun(chg_ipt) <span class="comment">#'12'-&gt;'0011000100110010'</span></span><br><span class="line">	bits_stream_R = fun(chg_ipt[::<span class="number">-1</span>]) <span class="comment">#'12'-&gt; '21'-&gt;'0011001000110001'</span></span><br><span class="line">	bit_arr[L] = int(bits_stream_L[i])</span><br><span class="line">	bit_arr[R] = int(bits_stream_R[i])</span><br></pre></td></tr></table></figure>
<hr>
<p>PART2是用来验证的，根据PART1算出来的bits_arr和另一个16*16的box中的数做一定的运算得出16个数，若全部相等则success。</p>
<p>256的box。</p>
<p><img src="http://img2.tan90.me/gadgetzan_3d055889d047898a7cfaa326015b70d1.png" alt=""></p>
<p>check用的16个数：</p>
<p><img src="http://img2.tan90.me/gadgetzan_de22372716d5c74d546e89a15bd3688f.png" alt=""></p>
<p>伪算法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">	tmp=<span class="number">0</span></span><br><span class="line">	check_word=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">		check_word ^= (box[i*<span class="number">16</span>+j] * bits_arr[j*<span class="number">16</span>+i])&amp;<span class="number">0xffff</span></span><br><span class="line">	<span class="keyword">if</span> check_word != flag_word[i]:</span><br><span class="line">		wrong</span><br><span class="line">		exit</span><br><span class="line"></span><br><span class="line">success</span><br></pre></td></tr></table></figure>
<p>由于bits_arr[j*16+i]只存在0和1，所以check_word所异或的只能为box[i*16+j]或0，因此，我们可以爆破这16位0和1。</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">check_sum = [<span class="number">0x86C1</span>,<span class="number">0x39A3</span>,<span class="number">0x0C239</span>,<span class="number">0x0B7EF</span>,<span class="number">0x0FEF</span>,<span class="number">0x3FB4</span>,<span class="number">0x2E25</span>,<span class="number">0x2216</span>,<span class="number">0x57D0</span>,<span class="number">0x8065</span>,<span class="number">0x699D</span>,<span class="number">0x3B3</span>,<span class="number">0x0CC0E</span>,<span class="number">0x0D4A7</span>,<span class="number">0x5260</span>,<span class="number">0x0EA18</span>]</span><br><span class="line"></span><br><span class="line">val = [<span class="number">0x8EBC</span>,<span class="number">0x475E</span>,<span class="number">0x23AF</span>,<span class="number">0x91D7</span>,<span class="number">0x0C8EB</span>,<span class="number">0x0E475</span>,<span class="number">0x0F23A</span>,<span class="number">0x791D</span>,<span class="number">0x0BC8E</span>,<span class="number">0x5E47</span>,<span class="number">0x0AF23</span>,<span class="number">0x0D791</span>,<span class="number">0x0EBC8</span>,<span class="number">0x75E4</span>,<span class="number">0x3AF2</span>,<span class="number">0x1D79</span>,<span class="number">0x2F11</span>,<span class="number">0x9788</span>,<span class="number">0x4BC4</span>,<span class="number">0x25E2</span>,<span class="number">0x12F1</span>,<span class="number">0x8978</span>,<span class="number">0x44BC</span>,<span class="number">0x225E</span>,<span class="number">0x112F</span>,<span class="number">0x8897</span>,<span class="number">0x0C44B</span>,<span class="number">0x0E225</span>,<span class="number">0x0F112</span>,<span class="number">0x7889</span>,<span class="number">0x0BC44</span>,<span class="number">0x5E22</span>,<span class="number">0x0D000</span>,<span class="number">0x6800</span>,<span class="number">0x3400</span>,<span class="number">0x1A00</span>,<span class="number">0x0D00</span>,<span class="number">0x680</span>,<span class="number">0x340</span>,<span class="number">0x1A0</span>,<span class="number">0x0D0</span>,<span class="number">0x68</span>,<span class="number">0x34</span>,<span class="number">0x1A</span>,<span class="number">0x0D</span>,<span class="number">0x8006</span>,<span class="number">0x4003</span>,<span class="number">0x0A001</span>,<span class="number">0x0F0A2</span>,<span class="number">0x7851</span>,<span class="number">0x0BC28</span>,<span class="number">0x5E14</span>,<span class="number">0x2F0A</span>,<span class="number">0x1785</span>,<span class="number">0x8BC2</span>,<span class="number">0x45E1</span>,<span class="number">0x0A2F0</span>,<span class="number">0x5178</span>,<span class="number">0x28BC</span>,<span class="number">0x145E</span>,<span class="number">0x0A2F</span>,<span class="number">0x8517</span>,<span class="number">0x0C28B</span>,<span class="number">0x0E145</span>,<span class="number">0x5750</span>,<span class="number">0x2BA8</span>,<span class="number">0x15D4</span>,<span class="number">0x0AEA</span>,<span class="number">0x575</span>,<span class="number">0x82BA</span>,<span class="number">0x415D</span>,<span class="number">0x0A0AE</span>,<span class="number">0x5057</span>,<span class="number">0x0A82B</span>,<span class="number">0x0D415</span>,<span class="number">0x0EA0A</span>,<span class="number">0x7505</span>,<span class="number">0x0BA82</span>,<span class="number">0x5D41</span>,<span class="number">0x0AEA0</span>,<span class="number">0x69F8</span>,<span class="number">0x34FC</span>,<span class="number">0x1A7E</span>,<span class="number">0x0D3F</span>,<span class="number">0x869F</span>,<span class="number">0x0C34F</span>,<span class="number">0x0E1A7</span>,<span class="number">0x0F0D3</span>,<span class="number">0x0F869</span>,<span class="number">0x0FC34</span>,<span class="number">0x7E1A</span>,<span class="number">0x3F0D</span>,<span class="number">0x9F86</span>,<span class="number">0x4FC3</span>,<span class="number">0x0A7E1</span>,<span class="number">0x0D3F0</span>,<span class="number">0x0EB49</span>,<span class="number">0x0F5A4</span>,<span class="number">0x7AD2</span>,<span class="number">0x3D69</span>,<span class="number">0x9EB4</span>,<span class="number">0x4F5A</span>,<span class="number">0x27AD</span>,<span class="number">0x93D6</span>,<span class="number">0x49EB</span>,<span class="number">0x0A4F5</span>,<span class="number">0x0D27A</span>,<span class="number">0x693D</span>,<span class="number">0x0B49E</span>,<span class="number">0x5A4F</span>,<span class="number">0x0AD27</span>,<span class="number">0x0D693</span>,<span class="number">0x0C241</span>,<span class="number">0x0E120</span>,<span class="number">0x7090</span>,<span class="number">0x3848</span>,<span class="number">0x1C24</span>,<span class="number">0x0E12</span>,<span class="number">0x709</span>,<span class="number">0x8384</span>,<span class="number">0x41C2</span>,<span class="number">0x20E1</span>,<span class="number">0x9070</span>,<span class="number">0x4838</span>,<span class="number">0x241C</span>,<span class="number">0x120E</span>,<span class="number">0x907</span>,<span class="number">0x8483</span>,<span class="number">0x0F7A</span>,<span class="number">0x7BD</span>,<span class="number">0x83DE</span>,<span class="number">0x41EF</span>,<span class="number">0x0A0F7</span>,<span class="number">0x0D07B</span>,<span class="number">0x0E83D</span>,<span class="number">0x0F41E</span>,<span class="number">0x7A0F</span>,<span class="number">0x0BD07</span>,<span class="number">0x0DE83</span>,<span class="number">0x0EF41</span>,<span class="number">0x0F7A0</span>,<span class="number">0x7BD0</span>,<span class="number">0x3DE8</span>,<span class="number">0x1EF4</span>,<span class="number">0x21DC</span>,<span class="number">0x10EE</span>,<span class="number">0x877</span>,<span class="number">0x843B</span>,<span class="number">0x0C21D</span>,<span class="number">0x0E10E</span>,<span class="number">0x7087</span>,<span class="number">0x0B843</span>,<span class="number">0x0DC21</span>,<span class="number">0x0EE10</span>,<span class="number">0x7708</span>,<span class="number">0x3B84</span>,<span class="number">0x1DC2</span>,<span class="number">0x0EE1</span>,<span class="number">0x8770</span>,<span class="number">0x43B8</span>,<span class="number">0x0E43D</span>,<span class="number">0x0F21E</span>,<span class="number">0x790F</span>,<span class="number">0x0BC87</span>,<span class="number">0x0DE43</span>,<span class="number">0x0EF21</span>,<span class="number">0x0F790</span>,<span class="number">0x7BC8</span>,<span class="number">0x3DE4</span>,<span class="number">0x1EF2</span>,<span class="number">0x0F79</span>,<span class="number">0x87BC</span>,<span class="number">0x43DE</span>,<span class="number">0x21EF</span>,<span class="number">0x90F7</span>,<span class="number">0x0C87B</span>,<span class="number">0x8F1D</span>,<span class="number">0x0C78E</span>,<span class="number">0x63C7</span>,<span class="number">0x0B1E3</span>,<span class="number">0x0D8F1</span>,<span class="number">0x0EC78</span>,<span class="number">0x763C</span>,<span class="number">0x3B1E</span>,<span class="number">0x1D8F</span>,<span class="number">0x8EC7</span>,<span class="number">0x0C763</span>,<span class="number">0x0E3B1</span>,<span class="number">0x0F1D8</span>,<span class="number">0x78EC</span>,<span class="number">0x3C76</span>,<span class="number">0x1E3B</span>,<span class="number">0x57E8</span>,<span class="number">0x2BF4</span>,<span class="number">0x15FA</span>,<span class="number">0x0AFD</span>,<span class="number">0x857E</span>,<span class="number">0x42BF</span>,<span class="number">0x0A15F</span>,<span class="number">0x0D0AF</span>,<span class="number">0x0E857</span>,<span class="number">0x0F42B</span>,<span class="number">0x0FA15</span>,<span class="number">0x0FD0A</span>,<span class="number">0x7E85</span>,<span class="number">0x0BF42</span>,<span class="number">0x5FA1</span>,<span class="number">0x0AFD0</span>,<span class="number">0x2EEC</span>,<span class="number">0x1776</span>,<span class="number">0x0BBB</span>,<span class="number">0x85DD</span>,<span class="number">0x0C2EE</span>,<span class="number">0x6177</span>,<span class="number">0x0B0BB</span>,<span class="number">0x0D85D</span>,<span class="number">0x0EC2E</span>,<span class="number">0x7617</span>,<span class="number">0x0BB0B</span>,<span class="number">0x0DD85</span>,<span class="number">0x0EEC2</span>,<span class="number">0x7761</span>,<span class="number">0x0BBB0</span>,<span class="number">0x5DD8</span>,<span class="number">0x62CC</span>,<span class="number">0x3166</span>,<span class="number">0x18B3</span>,<span class="number">0x8C59</span>,<span class="number">0x0C62C</span>,<span class="number">0x6316</span>,<span class="number">0x318B</span>,<span class="number">0x98C5</span>,<span class="number">0x0CC62</span>,<span class="number">0x6631</span>,<span class="number">0x0B318</span>,<span class="number">0x598C</span>,<span class="number">0x2CC6</span>,<span class="number">0x1663</span>,<span class="number">0x8B31</span>,<span class="number">0x0C598</span>,<span class="number">0x53FE</span>,<span class="number">0x29FF</span>,<span class="number">0x94FF</span>,<span class="number">0x0CA7F</span>,<span class="number">0x0E53F</span>,<span class="number">0x0F29F</span>,<span class="number">0x0F94F</span>,<span class="number">0x0FCA7</span>,<span class="number">0x0FE53</span>,<span class="number">0x0FF29</span>,<span class="number">0x0FF94</span>,<span class="number">0x7FCA</span>,<span class="number">0x3FE5</span>,<span class="number">0x9FF2</span>,<span class="number">0x4FF9</span>,<span class="number">0x0A7FC</span>]</span><br><span class="line"></span><br><span class="line">bit=[<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">out=[]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> range(len(check_sum)):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0xffff</span>):</span><br><span class="line">		check=<span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">			bit[j] = (i&amp;(<span class="number">1</span>&lt;&lt;j))/(<span class="number">1</span>&lt;&lt;j)<span class="comment">#di -&gt; gao</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">			check ^=(bit[j]*val[k*<span class="number">16</span>+j])</span><br><span class="line">		<span class="keyword">if</span> (check&amp;<span class="number">0xffff</span>)==check_sum[k]:</span><br><span class="line">			<span class="comment">#print bit</span></span><br><span class="line">			out.append(copy.deepcopy(bit))</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> zip(*out):<span class="comment">#矩阵转置</span></span><br><span class="line">	<span class="keyword">print</span> k</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0)</span><br><span class="line">(1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1)</span><br><span class="line">(1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0)</span><br><span class="line">(1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0)</span><br><span class="line">(0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1)</span><br><span class="line">(1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0)</span><br><span class="line">(0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0)</span><br><span class="line">(0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0)</span><br><span class="line">(1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1)</span><br><span class="line">(1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1)</span><br><span class="line">(1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1)</span><br><span class="line">(1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1)</span><br><span class="line">(1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0)</span><br><span class="line">(1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0)</span><br><span class="line">(0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0)</span><br><span class="line">(1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1)</span><br></pre></td></tr></table></figure>
<p>再对PART1求逆，就是根据box把相应的bit放回原来的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">out = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line"></span><br><span class="line">tbl=[<span class="number">0x36</span>,<span class="number">0x4F</span>,<span class="number">0x62</span>,<span class="number">0x0D8</span>,<span class="number">0x0B5</span>,<span class="number">0x84</span>,<span class="number">0x0CD</span>,<span class="number">0x0F6</span>,<span class="number">0x0DC</span>,<span class="number">0x2A</span>,<span class="number">0x0E6</span>,<span class="number">0x0ED</span>,<span class="number">0x0AB</span>,<span class="number">0x52</span>,<span class="number">0x1</span>,<span class="number">0x0AF</span>,<span class="number">0x0D0</span>,<span class="number">0x0A</span>,<span class="number">0x68</span>,<span class="number">0x14</span>,<span class="number">0x27</span>,<span class="number">0x0A1</span>,<span class="number">0x0DB</span>,<span class="number">0x87</span>,<span class="number">0x9C</span>,<span class="number">0x0E7</span>,<span class="number">0x29</span>,<span class="number">0x66</span>,<span class="number">0x35</span>,<span class="number">0x0E9</span>,<span class="number">0x0B4</span>,<span class="number">0x91</span>,<span class="number">0x8B</span>,<span class="number">0x0CE</span>,<span class="number">0x0F3</span>,<span class="number">0x34</span>,<span class="number">0x56</span>,<span class="number">0x5E</span>,<span class="number">0x23</span>,<span class="number">0x61</span>,<span class="number">0x70</span>,<span class="number">0x0C3</span>,<span class="number">0x0A7</span>,<span class="number">0x32</span>,<span class="number">0x2D</span>,<span class="number">0x80</span>,<span class="number">0x0C</span>,<span class="number">0x0C4</span>,<span class="number">0x0F5</span>,<span class="number">0x2C</span>,<span class="number">0x72</span>,<span class="number">0x0A4</span>,<span class="number">0x0C9</span>,<span class="number">0x6</span>,<span class="number">0x0B9</span>,<span class="number">0x6E</span>,<span class="number">0x19</span>,<span class="number">0x12</span>,<span class="number">0x7</span>,<span class="number">0x22</span>,<span class="number">0x0D6</span>,<span class="number">0x0D3</span>,<span class="number">0x0</span>,<span class="number">0x71</span>,<span class="number">0x98</span>,<span class="number">0x0E</span>,<span class="number">0x6B</span>,<span class="number">0x0CA</span>,<span class="number">0x64</span>,<span class="number">0x3D</span>,<span class="number">0x0BA</span>,<span class="number">0x0FE</span>,<span class="number">0x88</span>,<span class="number">0x2</span>,<span class="number">0x0E3</span>,<span class="number">0x46</span>,<span class="number">0x0EF</span>,<span class="number">0x1F</span>,<span class="number">0x2F</span>,<span class="number">0x8F</span>,<span class="number">0x2E</span>,<span class="number">0x3A</span>,<span class="number">0x31</span>,<span class="number">0x9B</span>,<span class="number">0x0F0</span>,<span class="number">0x0E2</span>,<span class="number">0x7B</span>,<span class="number">0x99</span>,<span class="number">0x0BB</span>,<span class="number">0x0A8</span>,<span class="number">0x48</span>,<span class="number">0x63</span>,<span class="number">0x0D4</span>,<span class="number">0x8D</span>,<span class="number">0x0F4</span>,<span class="number">0x69</span>,<span class="number">0x0BF</span>,<span class="number">0x0E8</span>,<span class="number">0x4B</span>,<span class="number">0x0DE</span>,<span class="number">0x0DA</span>,<span class="number">0x76</span>,<span class="number">0x0B0</span>,<span class="number">0x10</span>,<span class="number">0x0B8</span>,<span class="number">0x97</span>,<span class="number">0x0C6</span>,<span class="number">0x9F</span>,<span class="number">0x16</span>,<span class="number">0x0F7</span>,<span class="number">0x0AC</span>,<span class="number">0x0DD</span>,<span class="number">0x45</span>,<span class="number">0x0BC</span>,<span class="number">0x0C5</span>,<span class="number">0x0E1</span>,<span class="number">0x0AD</span>,<span class="number">0x7C</span>,<span class="number">0x5B</span>,<span class="number">0x0FC</span>,<span class="number">0x0CC</span>,<span class="number">0x0AE</span>,<span class="number">0x59</span>,<span class="number">0x9A</span>,<span class="number">0x6F</span>,<span class="number">0x0E5</span>,<span class="number">0x67</span>,<span class="number">0x0A3</span>,<span class="number">0x58</span>,<span class="number">0x0C7</span>,<span class="number">0x8C</span>,<span class="number">0x65</span>,<span class="number">0x81</span>,<span class="number">0x49</span>,<span class="number">0x53</span>,<span class="number">0x83</span>,<span class="number">0x40</span>,<span class="number">0x39</span>,<span class="number">0x5D</span>,<span class="number">0x37</span>,<span class="number">0x0B1</span>,<span class="number">0x74</span>,<span class="number">0x8E</span>,<span class="number">0x4D</span>,<span class="number">0x0CF</span>,<span class="number">0x33</span>,<span class="number">0x0F8</span>,<span class="number">0x0A2</span>,<span class="number">0x75</span>,<span class="number">0x73</span>,<span class="number">0x0FA</span>,<span class="number">0x0D7</span>,<span class="number">0x4A</span>,<span class="number">0x0CB</span>,<span class="number">0x82</span>,<span class="number">0x78</span>,<span class="number">0x17</span>,<span class="number">0x0E0</span>,<span class="number">0x95</span>,<span class="number">0x7D</span>,<span class="number">0x8</span>,<span class="number">0x0F1</span>,<span class="number">0x0BD</span>,<span class="number">0x41</span>,<span class="number">0x0B7</span>,<span class="number">0x4</span>,<span class="number">0x0F</span>,<span class="number">0x8A</span>,<span class="number">0x0D1</span>,<span class="number">0x51</span>,<span class="number">0x3E</span>,<span class="number">0x38</span>,<span class="number">0x93</span>,<span class="number">0x0C2</span>,<span class="number">0x89</span>,<span class="number">0x0D2</span>,<span class="number">0x96</span>,<span class="number">0x94</span>,<span class="number">0x1A</span>,<span class="number">0x0FB</span>,<span class="number">0x5F</span>,<span class="number">0x7E</span>,<span class="number">0x60</span>,<span class="number">0x24</span>,<span class="number">0x54</span>,<span class="number">0x0EA</span>,<span class="number">0x7F</span>,<span class="number">0x0B</span>,<span class="number">0x1B</span>,<span class="number">0x43</span>,<span class="number">0x26</span>,<span class="number">0x2B</span>,<span class="number">0x1C</span>,<span class="number">0x0B3</span>,<span class="number">0x4E</span>,<span class="number">0x85</span>,<span class="number">0x3F</span>,<span class="number">0x5A</span>,<span class="number">0x0C0</span>,<span class="number">0x1E</span>,<span class="number">0x50</span>,<span class="number">0x77</span>,<span class="number">0x0FF</span>,<span class="number">0x9</span>,<span class="number">0x0E4</span>,<span class="number">0x9E</span>,<span class="number">0x25</span>,<span class="number">0x9D</span>,<span class="number">0x5</span>,<span class="number">0x13</span>,<span class="number">0x0EE</span>,<span class="number">0x0D5</span>,<span class="number">0x30</span>,<span class="number">0x0AA</span>,<span class="number">0x28</span>,<span class="number">0x79</span>,<span class="number">0x86</span>,<span class="number">0x4C</span>,<span class="number">0x0F9</span>,<span class="number">0x57</span>,<span class="number">0x6D</span>,<span class="number">0x0EB</span>,<span class="number">0x47</span>,<span class="number">0x0B2</span>,<span class="number">0x0D9</span>,<span class="number">0x18</span>,<span class="number">0x0B6</span>,<span class="number">0x0BE</span>,<span class="number">0x7A</span>,<span class="number">0x0C1</span>,<span class="number">0x0A0</span>,<span class="number">0x0D</span>,<span class="number">0x5C</span>,<span class="number">0x0C8</span>,<span class="number">0x0A5</span>,<span class="number">0x44</span>,<span class="number">0x6A</span>,<span class="number">0x3C</span>,<span class="number">0x20</span>,<span class="number">0x0A6</span>,<span class="number">0x3</span>,<span class="number">0x11</span>,<span class="number">0x3B</span>,<span class="number">0x15</span>,<span class="number">0x90</span>,<span class="number">0x0FD</span>,<span class="number">0x92</span>,<span class="number">0x0EC</span>,<span class="number">0x0A9</span>,<span class="number">0x21</span>,<span class="number">0x55</span>,<span class="number">0x1D</span>,<span class="number">0x0DF</span>,<span class="number">0x6C</span>,<span class="number">0x42</span>,<span class="number">0x0F2</span>]</span><br><span class="line"></span><br><span class="line">enc=[</span><br><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x80</span>):</span><br><span class="line">	L = tbl[i]</span><br><span class="line">	R = tbl[i+<span class="number">0x80</span>]</span><br><span class="line"></span><br><span class="line">	out[i] = enc[L]</span><br><span class="line">	out[i+<span class="number">0x80</span>] = enc[R]</span><br><span class="line"></span><br><span class="line">out2=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">	ch=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">		ch +=out[j+<span class="number">8</span>*i]*(<span class="number">2</span>**j)</span><br><span class="line">	out2.append(ch)</span><br><span class="line"></span><br><span class="line">out3=<span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> out2:</span><br><span class="line">	out3+=hex(i)[<span class="number">2</span>:]</span><br><span class="line"><span class="keyword">print</span> out3[:<span class="number">32</span>]</span><br></pre></td></tr></table></figure>
<p>得到<code>chg_ipt</code>:<code>cad3e543f23c3fec33a93f95dd8c4c2a</code></p>
<hr>
<p>再来看func1。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">enc_func1</span><span class="params">(<span class="keyword">char</span> *input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *ipt_1; <span class="comment">// eax@1</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax@1</span></span><br><span class="line">  <span class="keyword">int</span> key; <span class="comment">// esi@1</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// edx@1</span></span><br><span class="line">  <span class="keyword">bool</span> v5; <span class="comment">// zf@1</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// ecx@1</span></span><br><span class="line">  <span class="keyword">char</span> *input_1; <span class="comment">// [sp+18h] [bp-50h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [sp+1Ch] [bp-4Ch]@1</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [sp+20h] [bp-48h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [sp+24h] [bp-44h]@1</span></span><br><span class="line">  <span class="keyword">int</span> chg_input; <span class="comment">// [sp+28h] [bp-40h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [sp+2Ch] [bp-3Ch]@1</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [sp+30h] [bp-38h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [sp+34h] [bp-34h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v16; <span class="comment">// [sp+38h] [bp-30h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v17; <span class="comment">// [sp+39h] [bp-2Fh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v18; <span class="comment">// [sp+3Ah] [bp-2Eh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v19; <span class="comment">// [sp+3Bh] [bp-2Dh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v20; <span class="comment">// [sp+3Ch] [bp-2Ch]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v21; <span class="comment">// [sp+3Dh] [bp-2Bh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v22; <span class="comment">// [sp+3Eh] [bp-2Ah]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v23; <span class="comment">// [sp+3Fh] [bp-29h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v24; <span class="comment">// [sp+40h] [bp-28h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v25; <span class="comment">// [sp+41h] [bp-27h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v26; <span class="comment">// [sp+42h] [bp-26h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v27; <span class="comment">// [sp+43h] [bp-25h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v28; <span class="comment">// [sp+44h] [bp-24h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v29; <span class="comment">// [sp+45h] [bp-23h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v30; <span class="comment">// [sp+46h] [bp-22h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v31; <span class="comment">// [sp+47h] [bp-21h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v32; <span class="comment">// [sp+48h] [bp-20h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v33; <span class="comment">// [sp+49h] [bp-1Fh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v34; <span class="comment">// [sp+4Ah] [bp-1Eh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v35; <span class="comment">// [sp+4Bh] [bp-1Dh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v36; <span class="comment">// [sp+4Ch] [bp-1Ch]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v37; <span class="comment">// [sp+4Dh] [bp-1Bh]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v38; <span class="comment">// [sp+4Eh] [bp-1Ah]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v39; <span class="comment">// [sp+4Fh] [bp-19h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v40; <span class="comment">// [sp+50h] [bp-18h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v41; <span class="comment">// [sp+51h] [bp-17h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v42; <span class="comment">// [sp+52h] [bp-16h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v43; <span class="comment">// [sp+53h] [bp-15h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v44; <span class="comment">// [sp+54h] [bp-14h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v45; <span class="comment">// [sp+55h] [bp-13h]@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v46; <span class="comment">// [sp+56h] [bp-12h]@1</span></span><br><span class="line">  <span class="keyword">char</span> v47; <span class="comment">// [sp+57h] [bp-11h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v48; <span class="comment">// [sp+58h] [bp-10h]@1</span></span><br><span class="line"></span><br><span class="line">  v16 = <span class="number">0xE6</span>u;</span><br><span class="line">  v48 = *MK_FP(__GS__, <span class="number">20</span>);</span><br><span class="line">  v17 = <span class="number">0xB8</span>u;</span><br><span class="line">  v18 = <span class="number">0xA1</span>u;</span><br><span class="line">  v19 = <span class="number">0xE3</span>u;</span><br><span class="line">  v20 = <span class="number">0x80</span>u;</span><br><span class="line">  v21 = <span class="number">0x82</span>u;</span><br><span class="line">  v22 = <span class="number">0xE6</span>u;</span><br><span class="line">  v23 = <span class="number">0xB8</span>u;</span><br><span class="line">  v24 = <span class="number">0xA1</span>u;</span><br><span class="line">  v25 = <span class="number">0xE3</span>u;</span><br><span class="line">  v26 = <span class="number">0x80</span>u;</span><br><span class="line">  v27 = <span class="number">0x82</span>u;</span><br><span class="line">  v28 = <span class="number">0xE6</span>u;</span><br><span class="line">  v29 = <span class="number">0xB8</span>u;</span><br><span class="line">  v30 = <span class="number">0xA1</span>u;</span><br><span class="line">  v31 = <span class="number">0xE3</span>u;</span><br><span class="line">  v32 = <span class="number">0x80</span>u;</span><br><span class="line">  v33 = <span class="number">0x82</span>u;</span><br><span class="line">  v34 = <span class="number">0xE6</span>u;</span><br><span class="line">  v35 = <span class="number">0xB8</span>u;</span><br><span class="line">  v36 = <span class="number">0xA1</span>u;</span><br><span class="line">  v37 = <span class="number">0xE3</span>u;</span><br><span class="line">  v38 = <span class="number">0x80</span>u;</span><br><span class="line">  v39 = <span class="number">0x82</span>u;</span><br><span class="line">  v40 = <span class="number">0xE6</span>u;</span><br><span class="line">  v41 = <span class="number">0xB8</span>u;</span><br><span class="line">  v42 = <span class="number">0xA1</span>u;</span><br><span class="line">  v43 = <span class="number">0xE3</span>u;</span><br><span class="line">  ipt_1 = *(<span class="keyword">char</span> **)input;</span><br><span class="line">  v44 = <span class="number">0x80</span>u;</span><br><span class="line">  v45 = <span class="number">0x82</span>u;</span><br><span class="line">  v46 = <span class="number">0xE6</span>u;</span><br><span class="line">  input_1 = ipt_1;</span><br><span class="line">  v2 = *((_DWORD *)input + <span class="number">1</span>);</span><br><span class="line">  v47 = <span class="number">-72</span>;</span><br><span class="line">  <span class="number">8</span> = <span class="number">8</span>;</span><br><span class="line">  keyround = <span class="number">14</span>;</span><br><span class="line">  v9 = v2;</span><br><span class="line">  v10 = *((_DWORD *)input + <span class="number">2</span>);</span><br><span class="line">  v11 = *((_DWORD *)input + <span class="number">3</span>);</span><br><span class="line">  key = <span class="built_in">malloc</span>(<span class="number">60</span> * size_int);</span><br><span class="line">  init_key((<span class="keyword">int</span>)&amp;v16, key);</span><br><span class="line">  AES_LIKE((<span class="keyword">int</span>)&amp;input_1, (<span class="keyword">int</span>)&amp;chg_input, key);</span><br><span class="line">  *(_DWORD *)input = chg_input;</span><br><span class="line">  *((_DWORD *)input + <span class="number">1</span>) = v13;</span><br><span class="line">  *((_DWORD *)input + <span class="number">2</span>) = v14;</span><br><span class="line">  v6 = *MK_FP(__GS__, <span class="number">20</span>) ^ v48;</span><br><span class="line">  v5 = *MK_FP(__GS__, <span class="number">20</span>) == v48;</span><br><span class="line">  *((_DWORD *)input + <span class="number">3</span>) = v15;                 <span class="comment">// chag input here</span></span><br><span class="line">  <span class="keyword">if</span> ( !v5 )</span><br><span class="line">    canary(v6, v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面一长段的v16不用管他，因为只是用来生成key的，key可以动态dump。之后就是把key，input传入一个向AES一样的函数，代码如下。</p>
<hr>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">AES_LIKE</span><span class="params">(<span class="keyword">int</span> input, <span class="keyword">int</span> output, <span class="keyword">int</span> key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// edi@1</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// esi@1</span></span><br><span class="line">  <span class="keyword">void</span> *v5; <span class="comment">// esp@1</span></span><br><span class="line">  <span class="keyword">int</span> *in; <span class="comment">// ebx@1</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// eax@3</span></span><br><span class="line">  <span class="keyword">int</span> k; <span class="comment">// edx@3</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// edi@7</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// esi@7</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// edx@8</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// esi@9</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// ecx@9</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// edx@9</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// edi@9</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// eax@11</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax@14</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// [sp+0h] [bp-48h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [sp+Ch] [bp-3Ch]@1</span></span><br><span class="line">  <span class="keyword">int</span> _key; <span class="comment">// [sp+10h] [bp-38h]@1</span></span><br><span class="line">  <span class="keyword">int</span> _input; <span class="comment">// [sp+14h] [bp-34h]@1</span></span><br><span class="line">  <span class="keyword">int</span> *v22; <span class="comment">// [sp+18h] [bp-30h]@3</span></span><br><span class="line">  <span class="keyword">int</span> *v23; <span class="comment">// [sp+1Ch] [bp-2Ch]@1</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// [sp+2Ch] [bp-1Ch]@1</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  _input = input;</span><br><span class="line">  v19 = output;</span><br><span class="line">  _key = key;</span><br><span class="line">  v24 = *MK_FP(__GS__, <span class="number">20</span>);</span><br><span class="line">  v23 = (<span class="keyword">int</span> *)size_int;</span><br><span class="line">  v5 = alloca(<span class="number">4</span> * size_int);</span><br><span class="line">  in = &amp;v18;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)v23 &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      j = <span class="number">0</span>;</span><br><span class="line">      k = <span class="number">0</span>;</span><br><span class="line">      v22 = in;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        ++k;</span><br><span class="line">        *((_BYTE *)v22 + j + v3) = *(_BYTE *)(_input + <span class="number">4</span> * j + v4);<span class="comment">// 4*4转置</span></span><br><span class="line">        j = (<span class="keyword">unsigned</span> __int8)k;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)v23 &gt; (<span class="keyword">unsigned</span> __int8)k );</span><br><span class="line">      in = v22;</span><br><span class="line">    &#125;</span><br><span class="line">    ++v4;</span><br><span class="line">    v3 += (<span class="keyword">int</span>)v23;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v4 != <span class="number">4</span> );</span><br><span class="line">  v9 = <span class="number">1</span>;</span><br><span class="line">  i = <span class="number">1</span>;</span><br><span class="line">  AddRoundKey((<span class="keyword">int</span>)in, _key, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( keyround &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      ++i;</span><br><span class="line">      SubBytes((<span class="keyword">int</span>)in);</span><br><span class="line">      ShiftRow((<span class="keyword">int</span>)in);</span><br><span class="line">      MixColumn(v11, (<span class="keyword">int</span>)in);</span><br><span class="line">      AddRoundKey((<span class="keyword">int</span>)in, _key, v9);</span><br><span class="line">      vm_func(in);</span><br><span class="line">      v9 = (<span class="keyword">unsigned</span> __int8)i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="keyword">unsigned</span> __int8)i &lt; keyround );</span><br><span class="line">  &#125;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  SubBytes((<span class="keyword">int</span>)in);</span><br><span class="line">  ShiftRow((<span class="keyword">int</span>)in);</span><br><span class="line">  AddRoundKey((<span class="keyword">int</span>)in, _key, (<span class="keyword">unsigned</span> __int8)keyround);</span><br><span class="line">  v14 = size_int;</span><br><span class="line">  v15 = v19;</span><br><span class="line">  v23 = in;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v14 &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = <span class="number">0</span>;</span><br><span class="line">      v13 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        ++v13;</span><br><span class="line">        *(_BYTE *)(v15 + <span class="number">4</span> * v16 + v12) = *((_BYTE *)v23 + v16 + v12 * v14);<span class="comment">// 4*4转置</span></span><br><span class="line">        v14 = size_int;</span><br><span class="line">        v16 = (<span class="keyword">unsigned</span> __int8)v13;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( (<span class="keyword">unsigned</span> __int8)v13 &lt; size_int );</span><br><span class="line">    &#125;</span><br><span class="line">    ++v12;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v12 != <span class="number">4</span> );</span><br><span class="line">  result = *MK_FP(__GS__, <span class="number">20</span>) ^ v24;</span><br><span class="line">  <span class="keyword">if</span> ( *MK_FP(__GS__, <span class="number">20</span>) != v24 )</span><br><span class="line">    canary(v13, v14);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数总体上没和传统的aes改变多少，主要改了两处：</p>
<hr>
<p>一是MixColumn函数中的a。</p>
<p>正常的a是这样的。</p>
<p><img src="http://img2.tan90.me/gadgetzan_cff99f1103b06559e2abd48b65850751.png" alt=""></p>
<p>而这里是0xD,0xE,0xF,0xD。</p>
<p><img src="http://img2.tan90.me/gadgetzan_cb441cc1323e73e48d21e8be0d5d0978.png" alt=""></p>
<p>对这个a求逆我们用matlab。<br><img src="http://img2.tan90.me/gadgetzan_06f33c245df3b058926139cd629b1ff1.png" alt=""></p>
<p>所以inv_a = [7,1,5,2]（此处感谢大佬的帮助）</p>
<hr>
<p>二是自己加了一个vm函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> (__cdecl *__cdecl vm_func(_DWORD *a1))(_DWORD, _DWORD)</span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *in; <span class="comment">// ebx@1</span></span><br><span class="line">  _DWORD *v2; <span class="comment">// ebp@1</span></span><br><span class="line">  _DWORD *v3; <span class="comment">// edi@1</span></span><br><span class="line">  struc_1 *s; <span class="comment">// eax@1</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// edx@1</span></span><br><span class="line">  struc_1 *v6; <span class="comment">// ST1C_4@1</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// edx@1</span></span><br><span class="line"></span><br><span class="line">  in = (_DWORD *)<span class="built_in">calloc</span>(<span class="number">64</span>, <span class="number">1u</span>);</span><br><span class="line">  v2 = (_DWORD *)<span class="built_in">calloc</span>(<span class="number">64</span>, <span class="number">1u</span>);</span><br><span class="line">  v3 = (_DWORD *)<span class="built_in">calloc</span>(<span class="number">32</span>, <span class="number">1u</span>);</span><br><span class="line">  s = (struc_1 *)<span class="built_in">malloc</span>(<span class="number">16</span>);</span><br><span class="line">  v5 = *a1;</span><br><span class="line">  s-&gt;reg = (reg *)v3;</span><br><span class="line">  s-&gt;out = (<span class="keyword">int</span>)in;</span><br><span class="line">  s-&gt;pc = (<span class="keyword">int</span>)&amp;code;</span><br><span class="line">  v6 = s;</span><br><span class="line">  in[4] = 'uhci';                               // input + ichunqiuichunqiu</span><br><span class="line">  *in = v5;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">  in[5] = 'uiqn';</span><br><span class="line">  in[6] = 'uhci';</span><br><span class="line">  in[7] = 'uiqn';</span><br><span class="line">  in[<span class="number">1</span>] = v7;</span><br><span class="line">  in[<span class="number">2</span>] = a1[<span class="number">2</span>];</span><br><span class="line">  in[<span class="number">3</span>] = a1[<span class="number">3</span>];</span><br><span class="line">  s-&gt;tmp_val = (<span class="keyword">int</span>)(v2 + <span class="number">32</span>);</span><br><span class="line">  interpreter(s);</span><br><span class="line">  *a1 = *in;</span><br><span class="line">  a1[<span class="number">1</span>] = in[<span class="number">1</span>];</span><br><span class="line">  a1[<span class="number">2</span>] = in[<span class="number">2</span>];</span><br><span class="line">  a1[<span class="number">3</span>] = in[<span class="number">3</span>];</span><br><span class="line">  <span class="built_in">free</span>((<span class="keyword">int</span>)in);</span><br><span class="line">  <span class="built_in">free</span>((<span class="keyword">int</span>)v2);</span><br><span class="line">  <span class="built_in">free</span>((<span class="keyword">int</span>)v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">free</span>((<span class="keyword">int</span>)v6);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字节码解释器代码：（此处再次感谢大佬的帮助233）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">interpreter</span><span class="params">(struc_1 *vm_ds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *byte_code_buffer; <span class="comment">// edx@1</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> byte_code; <span class="comment">// eax@1</span></span><br><span class="line">  __int8 *tmp_pc; <span class="comment">// eax@3</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// eax@5</span></span><br><span class="line"></span><br><span class="line">  byte_code_buffer = (<span class="keyword">char</span> *)vm_ds-&gt;pc;</span><br><span class="line">  byte_code = *(_BYTE *)vm_ds-&gt;pc - <span class="number">12</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( byte_code )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x98</span>u:</span><br><span class="line">        tmp_pc = byte_code_buffer + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( vm_ds-&gt;reg-&gt;flag != <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xA0</span>u:</span><br><span class="line">        <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x9D</span>u:</span><br><span class="line">        or_set((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x94</span>u:</span><br><span class="line">        dec_set(vm_ds, byte_code_buffer[<span class="number">1</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x8D</span>u:</span><br><span class="line">        set_output((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], *(_DWORD *)(byte_code_buffer + <span class="number">2</span>), <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x7E</span>u:</span><br><span class="line">        get_output_to_reg((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], *(_DWORD *)(byte_code_buffer + <span class="number">2</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x7A</span>u:</span><br><span class="line">        set_next_code_from_reg(&amp;vm_ds-&gt;pc, byte_code_buffer[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x79</span>u:</span><br><span class="line">        subb_reg((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x77</span>u:</span><br><span class="line">        set_output((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], *(_DWORD *)(byte_code_buffer + <span class="number">2</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x67</span>u:</span><br><span class="line">        tmp_pc = byte_code_buffer + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( vm_ds-&gt;reg-&gt;flag )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x65</span>u:</span><br><span class="line">        set_next_code_from_reg(&amp;vm_ds-&gt;pc, byte_code_buffer[<span class="number">1</span>], <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x64</span>u:</span><br><span class="line">        xor(vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x5B</span>u:</span><br><span class="line">        set_tmp_v((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x2A</span>u:</span><br><span class="line">        tmp_pc = byte_code_buffer + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( vm_ds-&gt;reg-&gt;flag == <span class="number">2</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x25</span>u:</span><br><span class="line">        and_reg(vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x21</span>u:</span><br><span class="line">        mov(vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x1E</span>u:</span><br><span class="line">        tmp_pc = byte_code_buffer + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( vm_ds-&gt;reg-&gt;flag &lt;= <span class="number">1u</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">9u</span>:</span><br><span class="line">        mul(vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8u</span>:</span><br><span class="line">        tmp_pc = byte_code_buffer + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( vm_ds-&gt;reg-&gt;flag == <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0u</span>:</span><br><span class="line">        inc(vm_ds, byte_code_buffer[<span class="number">1</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xF3</span>u:</span><br><span class="line">        <span class="keyword">return</span> byte_code;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xF2</span>u:</span><br><span class="line">        get_output_to_reg((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], *(_DWORD *)(byte_code_buffer + <span class="number">2</span>), <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xEF</span>u:</span><br><span class="line">        tmp_pc = byte_code_buffer + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !vm_ds-&gt;reg-&gt;flag )</span><br><span class="line">LABEL_4:</span><br><span class="line">          tmp_pc = &amp;byte_code_buffer[*(_DWORD *)(byte_code_buffer + <span class="number">1</span>) - <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xED</span>u:</span><br><span class="line">        set_next_code_from_reg(&amp;vm_ds-&gt;pc, byte_code_buffer[<span class="number">1</span>], <span class="number">2</span>);</span><br><span class="line">LABEL_14:</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xE6</span>u:</span><br><span class="line">        get_output_to_reg((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], *(_DWORD *)(byte_code_buffer + <span class="number">2</span>), <span class="number">2</span>);</span><br><span class="line">LABEL_12:</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xDD</span>u:</span><br><span class="line">        set_output((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], *(_DWORD *)(byte_code_buffer + <span class="number">2</span>), <span class="number">2</span>);</span><br><span class="line">LABEL_10:</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xD9</span>u:</span><br><span class="line">        tmp_pc = byte_code_buffer + <span class="number">2</span>;</span><br><span class="line">        vm_ds-&gt;tmp_val = *(_DWORD *)(byte_code_buffer + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xBF</span>u:</span><br><span class="line">        set_reg_add_16(vm_ds, byte_code_buffer[<span class="number">1</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xB7</span>u:</span><br><span class="line">        cmp(vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xB5</span>u:</span><br><span class="line">        add_reg(vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xAB</span>u:</span><br><span class="line">        div_reg((<span class="keyword">int</span>)vm_ds, byte_code_buffer[<span class="number">1</span>], byte_code_buffer[<span class="number">2</span>]);</span><br><span class="line">        tmp_pc = (__int8 *)vm_ds-&gt;pc;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      byte_code_buffer = tmp_pc + <span class="number">3</span>;</span><br><span class="line">      v4 = (<span class="keyword">unsigned</span> __int8)tmp_pc[<span class="number">3</span>];</span><br><span class="line">      vm_ds-&gt;pc = (<span class="keyword">int</span>)byte_code_buffer;</span><br><span class="line">      byte_code = v4 - <span class="number">12</span>;</span><br><span class="line">      <span class="keyword">if</span> ( byte_code &lt;= <span class="number">0xF3</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">LABEL_6:</span><br><span class="line">      tmp_pc = byte_code_buffer - <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由此还原字节码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c2n</span><span class="params">(char)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> str(ord(char))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">disasm</span><span class="params">(code)</span>:</span></span><br><span class="line">    pc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        c = ord(code[pc])<span class="number">-12</span></span><br><span class="line">        <span class="keyword">print</span> hex(pc),<span class="string">':'</span>,</span><br><span class="line">        <span class="keyword">if</span> c == <span class="number">0x98</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'jnz '</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc+=(<span class="number">2</span>+<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xa0</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'jmp '</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x9d</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'or $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x94</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'dec $'</span> + c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x8d</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'out $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', !'</span> + hex(u32(code[pc+<span class="number">2</span>:pc+<span class="number">6</span>]))</span><br><span class="line">            pc+=<span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x7e</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'in $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', !'</span> + hex(u32(code[pc+<span class="number">2</span>:pc+<span class="number">6</span>]))</span><br><span class="line">            pc+=<span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x7a</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'set_next_code_byte $'</span> + c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x79</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'sub $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x77</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'outb $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', !'</span> + hex(u32(code[pc+<span class="number">2</span>:pc+<span class="number">6</span>]))</span><br><span class="line">            pc+=<span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x67</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'jge '</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x65</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'set_next_code $'</span> + c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x64</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'xor $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x5b</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'settmp $'</span>+ c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x2a</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'jg $'</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x25</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'and $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x21</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'mov $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x1e</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'jbe $'</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x9</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'mul $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0x8</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'jz $'</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc+=<span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'inc $'</span> +c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xf3</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'ret'</span></span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xef</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'j0 $'</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc+=<span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xed</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'set_next_code_word $'</span> + c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xe6</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'in_word $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', !'</span> + hex(u32(code[pc+<span class="number">2</span>:pc+<span class="number">6</span>]))</span><br><span class="line">            pc+<span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xdd</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'out_word $'</span>  + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', !'</span> + hex(u32(code[pc+<span class="number">2</span>:pc+<span class="number">6</span>]))</span><br><span class="line">            pc += <span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xd9</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'set_tmp #'</span> + hex(u32(code[pc+<span class="number">1</span>:pc+<span class="number">5</span>]))</span><br><span class="line">            pc+=<span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xbf</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'get_tmp $'</span> + c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xb7</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'cmp $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xb5</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'add $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> c == <span class="number">0xab</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'div $'</span> + c2n(code[pc+<span class="number">1</span>]) + <span class="string">', $'</span> + c2n(code[pc+<span class="number">2</span>])</span><br><span class="line">            pc+=<span class="number">3</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> c2n(code[pc+<span class="number">1</span>])</span><br><span class="line">            pc+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">code = <span class="string">'700000E510000000CB01E50F000000CB02C30002735800000071008A030000000071018A04000000007003047100830300000000E50F000000CB03E50E000000CB0485030085040071038A030000000071048A050000000070050371048305000000000C000C01ACAAFFFFFFFF'</span>.decode(<span class="string">'hex'</span>)</span><br><span class="line">disasm(code)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">0x0 : xor $0, $0</span><br><span class="line">0x3 : set_tmp #0x10</span><br><span class="line">0x8 : get_tmp $1</span><br><span class="line">0xa : set_tmp #0xf</span><br><span class="line">0xf : get_tmp $2</span><br><span class="line">0x11 : cmp $0, $2</span><br><span class="line">0x14 : jge 0x58</span><br><span class="line">0x19 : set_next_code $0</span><br><span class="line">0x1b : in $3, !0x0</span><br><span class="line">0x21 : set_next_code $1</span><br><span class="line">0x23 : in $4, !0x0</span><br><span class="line">0x29 : xor $3, $4</span><br><span class="line">0x2c : set_next_code $0</span><br><span class="line">0x2e : outb $3, !0x0</span><br><span class="line">0x34 : set_tmp #0xf</span><br><span class="line">0x39 : get_tmp $3</span><br><span class="line">0x3b : set_tmp #0xe</span><br><span class="line">0x40 : get_tmp $4</span><br><span class="line">0x42 : sub $3, $0</span><br><span class="line">0x45 : sub $4, $0</span><br><span class="line">0x48 : set_next_code $3</span><br><span class="line">0x4a : in $3, !0x0</span><br><span class="line">0x50 : set_next_code $4</span><br><span class="line">0x52 : in $5, !0x0</span><br><span class="line">0x58 : xor $5, $3</span><br><span class="line">0x5b : set_next_code $4</span><br><span class="line">0x5d : outb $5, !0x0</span><br><span class="line">0x63 : inc $0</span><br><span class="line">0x65 : inc $1</span><br><span class="line">0x67 : jmp 0xffffffaa</span><br><span class="line">0x6a : ret</span><br></pre></td></tr></table></figure>
<p>通过整理逻辑，写出加密函数和解密函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unknow</span><span class="params">(plain)</span>:</span></span><br><span class="line">	data = list(plain.decode(<span class="string">'hex'</span>)+<span class="string">'ichunqiu'</span>*<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">		data[i] = chr(ord(data[i])^ord(data[i+<span class="number">16</span>]))</span><br><span class="line">		data[<span class="number">14</span>-i] = chr(ord(data[<span class="number">15</span>-i])^ord(data[<span class="number">14</span>-i]))</span><br><span class="line">	<span class="keyword">print</span> <span class="string">''</span>.join(data).encode(<span class="string">'hex'</span>)[:<span class="number">32</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_unknow</span><span class="params">(plain)</span>:</span></span><br><span class="line">	data = list(plain.decode(<span class="string">'hex'</span>)+<span class="string">'ichunqiu'</span>*<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(<span class="number">15</span>)):</span><br><span class="line">		data[<span class="number">14</span>-i] = chr(ord(data[<span class="number">15</span>-i])^ord(data[<span class="number">14</span>-i]))</span><br><span class="line">		data[i] = chr(ord(data[i])^ord(data[i+<span class="number">16</span>]))</span><br><span class="line">	<span class="keyword">print</span> <span class="string">''</span>.join(data).encode(<span class="string">'hex'</span>)[:<span class="number">32</span>]</span><br></pre></td></tr></table></figure>
<p>结合前面变形的AES，写出完整的func1逆代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">head = <span class="string">'e6b8a1e38082e6b8a1e38082e6b8a1e38082e6b8a1e38082e6b8a1e38082e6b86b18f5bbeb9a13034a799381acc13262133194f3b2d21471546ab592d4e8532a3583528bde1941889460d20938a1e06b0ac04d6cb812591dec78ec8f3890bfa5fea8569220b1171ab4d1c5138c702578bb8513a003974abdefefa632d77f1997554f81eb75fe96f1c12f53e24d5f769aa4ec4822a77b029f4894a4ad9febbd3a010c869674f21067b5dd4385f882351f0d604eb3aa1b4c2ce28fe8817d6455bbfbee8d738f1c9d143ac1de91c243eb8e43aa0a3de9b146110b3eae90765afb2bf3f3bf287cef223c462efcad846d1723'</span>.decode(<span class="string">'hex'</span>)</span><br><span class="line">box=[<span class="number">0x36</span>,<span class="number">0x4F</span>,<span class="number">0x62</span>,<span class="number">0x0D8</span>,<span class="number">0x0B5</span>,<span class="number">0x84</span>,<span class="number">0x0CD</span>,<span class="number">0x0F6</span>,<span class="number">0x0DC</span>,<span class="number">0x2A</span>,<span class="number">0x0E6</span>,<span class="number">0x0ED</span>,<span class="number">0x0AB</span>,<span class="number">0x52</span>,<span class="number">0x1</span>,<span class="number">0x0AF</span>,<span class="number">0x0D0</span>,<span class="number">0x0A</span>,<span class="number">0x68</span>,<span class="number">0x14</span>,<span class="number">0x27</span>,<span class="number">0x0A1</span>,<span class="number">0x0DB</span>,<span class="number">0x87</span>,<span class="number">0x9C</span>,<span class="number">0x0E7</span>,<span class="number">0x29</span>,<span class="number">0x66</span>,<span class="number">0x35</span>,<span class="number">0x0E9</span>,<span class="number">0x0B4</span>,<span class="number">0x91</span>,<span class="number">0x8B</span>,<span class="number">0x0CE</span>,<span class="number">0x0F3</span>,<span class="number">0x34</span>,<span class="number">0x56</span>,<span class="number">0x5E</span>,<span class="number">0x23</span>,<span class="number">0x61</span>,<span class="number">0x70</span>,<span class="number">0x0C3</span>,<span class="number">0x0A7</span>,<span class="number">0x32</span>,<span class="number">0x2D</span>,<span class="number">0x80</span>,<span class="number">0x0C</span>,<span class="number">0x0C4</span>,<span class="number">0x0F5</span>,<span class="number">0x2C</span>,<span class="number">0x72</span>,<span class="number">0x0A4</span>,<span class="number">0x0C9</span>,<span class="number">0x6</span>,<span class="number">0x0B9</span>,<span class="number">0x6E</span>,<span class="number">0x19</span>,<span class="number">0x12</span>,<span class="number">0x7</span>,<span class="number">0x22</span>,<span class="number">0x0D6</span>,<span class="number">0x0D3</span>,<span class="number">0x0</span>,<span class="number">0x71</span>,<span class="number">0x98</span>,<span class="number">0x0E</span>,<span class="number">0x6B</span>,<span class="number">0x0CA</span>,<span class="number">0x64</span>,<span class="number">0x3D</span>,<span class="number">0x0BA</span>,<span class="number">0x0FE</span>,<span class="number">0x88</span>,<span class="number">0x2</span>,<span class="number">0x0E3</span>,<span class="number">0x46</span>,<span class="number">0x0EF</span>,<span class="number">0x1F</span>,<span class="number">0x2F</span>,<span class="number">0x8F</span>,<span class="number">0x2E</span>,<span class="number">0x3A</span>,<span class="number">0x31</span>,<span class="number">0x9B</span>,<span class="number">0x0F0</span>,<span class="number">0x0E2</span>,<span class="number">0x7B</span>,<span class="number">0x99</span>,<span class="number">0x0BB</span>,<span class="number">0x0A8</span>,<span class="number">0x48</span>,<span class="number">0x63</span>,<span class="number">0x0D4</span>,<span class="number">0x8D</span>,<span class="number">0x0F4</span>,<span class="number">0x69</span>,<span class="number">0x0BF</span>,<span class="number">0x0E8</span>,<span class="number">0x4B</span>,<span class="number">0x0DE</span>,<span class="number">0x0DA</span>,<span class="number">0x76</span>,<span class="number">0x0B0</span>,<span class="number">0x10</span>,<span class="number">0x0B8</span>,<span class="number">0x97</span>,<span class="number">0x0C6</span>,<span class="number">0x9F</span>,<span class="number">0x16</span>,<span class="number">0x0F7</span>,<span class="number">0x0AC</span>,<span class="number">0x0DD</span>,<span class="number">0x45</span>,<span class="number">0x0BC</span>,<span class="number">0x0C5</span>,<span class="number">0x0E1</span>,<span class="number">0x0AD</span>,<span class="number">0x7C</span>,<span class="number">0x5B</span>,<span class="number">0x0FC</span>,<span class="number">0x0CC</span>,<span class="number">0x0AE</span>,<span class="number">0x59</span>,<span class="number">0x9A</span>,<span class="number">0x6F</span>,<span class="number">0x0E5</span>,<span class="number">0x67</span>,<span class="number">0x0A3</span>,<span class="number">0x58</span>,<span class="number">0x0C7</span>,<span class="number">0x8C</span>,<span class="number">0x65</span>,<span class="number">0x81</span>,<span class="number">0x49</span>,<span class="number">0x53</span>,<span class="number">0x83</span>,<span class="number">0x40</span>,<span class="number">0x39</span>,<span class="number">0x5D</span>,<span class="number">0x37</span>,<span class="number">0x0B1</span>,<span class="number">0x74</span>,<span class="number">0x8E</span>,<span class="number">0x4D</span>,<span class="number">0x0CF</span>,<span class="number">0x33</span>,<span class="number">0x0F8</span>,<span class="number">0x0A2</span>,<span class="number">0x75</span>,<span class="number">0x73</span>,<span class="number">0x0FA</span>,<span class="number">0x0D7</span>,<span class="number">0x4A</span>,<span class="number">0x0CB</span>,<span class="number">0x82</span>,<span class="number">0x78</span>,<span class="number">0x17</span>,<span class="number">0x0E0</span>,<span class="number">0x95</span>,<span class="number">0x7D</span>,<span class="number">0x8</span>,<span class="number">0x0F1</span>,<span class="number">0x0BD</span>,<span class="number">0x41</span>,<span class="number">0x0B7</span>,<span class="number">0x4</span>,<span class="number">0x0F</span>,<span class="number">0x8A</span>,<span class="number">0x0D1</span>,<span class="number">0x51</span>,<span class="number">0x3E</span>,<span class="number">0x38</span>,<span class="number">0x93</span>,<span class="number">0x0C2</span>,<span class="number">0x89</span>,<span class="number">0x0D2</span>,<span class="number">0x96</span>,<span class="number">0x94</span>,<span class="number">0x1A</span>,<span class="number">0x0FB</span>,<span class="number">0x5F</span>,<span class="number">0x7E</span>,<span class="number">0x60</span>,<span class="number">0x24</span>,<span class="number">0x54</span>,<span class="number">0x0EA</span>,<span class="number">0x7F</span>,<span class="number">0x0B</span>,<span class="number">0x1B</span>,<span class="number">0x43</span>,<span class="number">0x26</span>,<span class="number">0x2B</span>,<span class="number">0x1C</span>,<span class="number">0x0B3</span>,<span class="number">0x4E</span>,<span class="number">0x85</span>,<span class="number">0x3F</span>,<span class="number">0x5A</span>,<span class="number">0x0C0</span>,<span class="number">0x1E</span>,<span class="number">0x50</span>,<span class="number">0x77</span>,<span class="number">0x0FF</span>,<span class="number">0x9</span>,<span class="number">0x0E4</span>,<span class="number">0x9E</span>,<span class="number">0x25</span>,<span class="number">0x9D</span>,<span class="number">0x5</span>,<span class="number">0x13</span>,<span class="number">0x0EE</span>,<span class="number">0x0D5</span>,<span class="number">0x30</span>,<span class="number">0x0AA</span>,<span class="number">0x28</span>,<span class="number">0x79</span>,<span class="number">0x86</span>,<span class="number">0x4C</span>,<span class="number">0x0F9</span>,<span class="number">0x57</span>,<span class="number">0x6D</span>,<span class="number">0x0EB</span>,<span class="number">0x47</span>,<span class="number">0x0B2</span>,<span class="number">0x0D9</span>,<span class="number">0x18</span>,<span class="number">0x0B6</span>,<span class="number">0x0BE</span>,<span class="number">0x7A</span>,<span class="number">0x0C1</span>,<span class="number">0x0A0</span>,<span class="number">0x0D</span>,<span class="number">0x5C</span>,<span class="number">0x0C8</span>,<span class="number">0x0A5</span>,<span class="number">0x44</span>,<span class="number">0x6A</span>,<span class="number">0x3C</span>,<span class="number">0x20</span>,<span class="number">0x0A6</span>,<span class="number">0x3</span>,<span class="number">0x11</span>,<span class="number">0x3B</span>,<span class="number">0x15</span>,<span class="number">0x90</span>,<span class="number">0x0FD</span>,<span class="number">0x92</span>,<span class="number">0x0EC</span>,<span class="number">0x0A9</span>,<span class="number">0x21</span>,<span class="number">0x55</span>,<span class="number">0x1D</span>,<span class="number">0x0DF</span>,<span class="number">0x6C</span>,<span class="number">0x42</span>,<span class="number">0x0F2</span>]</span><br><span class="line">inv_box = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">inv_a = [<span class="number">7</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>]</span><br><span class="line">a = [<span class="number">0xe</span>,<span class="number">0xd</span>,<span class="number">0xd</span>,<span class="number">0xf</span>]</span><br><span class="line"></span><br><span class="line">int_1 = <span class="number">14</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddRoundKey</span><span class="params">(tmp,head,k)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		tmp[j] ^= ord(head[<span class="number">16</span>*k+<span class="number">4</span>*j])</span><br><span class="line">		tmp[j+<span class="number">4</span>] ^= ord(head[<span class="number">16</span>*k+<span class="number">4</span>*j+<span class="number">1</span>])</span><br><span class="line">		tmp[j+<span class="number">8</span>] ^= ord(head[<span class="number">16</span>*k+<span class="number">4</span>*j+<span class="number">2</span>])</span><br><span class="line">		tmp[j+<span class="number">12</span>] ^= ord(head[<span class="number">16</span>*k+<span class="number">4</span>*j+<span class="number">3</span>])</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_ShiftRows</span><span class="params">(tmp)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">			v3 = tmp[<span class="number">4</span>*i+<span class="number">3</span>]</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">3</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">				tmp[<span class="number">4</span>*i+k] = tmp[<span class="number">4</span>*i+k<span class="number">-1</span>]</span><br><span class="line">			tmp[<span class="number">4</span>*i] = v3</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ShiftRows</span><span class="params">(tmp)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">			v3 = tmp[<span class="number">4</span>*i]</span><br><span class="line">			<span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">3</span>):</span><br><span class="line">				tmp[<span class="number">4</span>*i+k] = tmp[<span class="number">4</span>*i+k+<span class="number">1</span>]</span><br><span class="line">			tmp[<span class="number">4</span>*i+<span class="number">3</span>] = v3</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SubBytes</span><span class="params">(tmp)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			tmp[<span class="number">4</span>*i+j] = box[<span class="number">16</span> * (tmp[<span class="number">4</span>*i+j] &amp; <span class="number">0xF</span>) + (( tmp[<span class="number">4</span>*i+j] &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>)]</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_SubBytes</span><span class="params">(tmp)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        inv_box[box[i]] = i</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            tmp[<span class="number">4</span>*i+j] = inv_box[tmp[<span class="number">4</span>*i+j]]</span><br><span class="line">            tmp[<span class="number">4</span>*i+j] = <span class="number">16</span> * (tmp[<span class="number">4</span>*i+j] &amp; <span class="number">0xF</span>) + (( tmp[<span class="number">4</span>*i+j] &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mix_single_column</span><span class="params">(v6)</span>:</span></span><br><span class="line">	d = [<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">	d[<span class="number">0</span>] = gmult(a[<span class="number">0</span>],v6[<span class="number">0</span>])^gmult(a[<span class="number">3</span>],v6[<span class="number">1</span>])^gmult(a[<span class="number">2</span>],v6[<span class="number">2</span>])^gmult(a[<span class="number">1</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	d[<span class="number">1</span>] = gmult(a[<span class="number">1</span>],v6[<span class="number">0</span>])^gmult(a[<span class="number">0</span>],v6[<span class="number">1</span>])^gmult(a[<span class="number">3</span>],v6[<span class="number">2</span>])^gmult(a[<span class="number">2</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	d[<span class="number">2</span>] = gmult(a[<span class="number">2</span>],v6[<span class="number">0</span>])^gmult(a[<span class="number">1</span>],v6[<span class="number">1</span>])^gmult(a[<span class="number">0</span>],v6[<span class="number">2</span>])^gmult(a[<span class="number">3</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	d[<span class="number">3</span>] = gmult(a[<span class="number">3</span>],v6[<span class="number">0</span>])^gmult(a[<span class="number">2</span>],v6[<span class="number">1</span>])^gmult(a[<span class="number">1</span>],v6[<span class="number">2</span>])^gmult(a[<span class="number">0</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	<span class="keyword">return</span> d</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gmult</span><span class="params">(aa,bb)</span>:</span></span><br><span class="line">	p=<span class="number">0</span></span><br><span class="line">	hbs=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">		<span class="keyword">if</span> (bb&amp;<span class="number">1</span>):</span><br><span class="line">			p ^= aa</span><br><span class="line">		hbs=aa&amp;<span class="number">0x80</span></span><br><span class="line">		aa&lt;&lt;=<span class="number">1</span></span><br><span class="line">		aa = aa&amp;<span class="number">0xff</span></span><br><span class="line">		<span class="keyword">if</span> hbs:</span><br><span class="line">			aa ^= <span class="number">0x1b</span></span><br><span class="line">		bb&gt;&gt;=<span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> p</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mix_columns</span><span class="params">(tmp)</span>:</span></span><br><span class="line">	v6 = [<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			v6[j] = tmp[<span class="number">4</span>*j+i]</span><br><span class="line">		v6 = mix_single_column(v6)</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			tmp[<span class="number">4</span>*j+i] = v6[j]</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_mix_columns</span><span class="params">(tmp)</span>:</span></span><br><span class="line">	v6 = [<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			v6[j] = tmp[<span class="number">4</span>*j+i]</span><br><span class="line">		v6 = inv_mix_single_column(v6)</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			tmp[<span class="number">4</span>*j+i] = v6[j]</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_mix_single_column</span><span class="params">(v6)</span>:</span></span><br><span class="line">	d = [<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">	d[<span class="number">0</span>] = gmult(inv_a[<span class="number">0</span>],v6[<span class="number">0</span>])^gmult(inv_a[<span class="number">3</span>],v6[<span class="number">1</span>])^gmult(inv_a[<span class="number">2</span>],v6[<span class="number">2</span>])^gmult(inv_a[<span class="number">1</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	d[<span class="number">1</span>] = gmult(inv_a[<span class="number">1</span>],v6[<span class="number">0</span>])^gmult(inv_a[<span class="number">0</span>],v6[<span class="number">1</span>])^gmult(inv_a[<span class="number">3</span>],v6[<span class="number">2</span>])^gmult(inv_a[<span class="number">2</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	d[<span class="number">2</span>] = gmult(inv_a[<span class="number">2</span>],v6[<span class="number">0</span>])^gmult(inv_a[<span class="number">1</span>],v6[<span class="number">1</span>])^gmult(inv_a[<span class="number">0</span>],v6[<span class="number">2</span>])^gmult(inv_a[<span class="number">3</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	d[<span class="number">3</span>] = gmult(inv_a[<span class="number">3</span>],v6[<span class="number">0</span>])^gmult(inv_a[<span class="number">2</span>],v6[<span class="number">1</span>])^gmult(inv_a[<span class="number">1</span>],v6[<span class="number">2</span>])^gmult(inv_a[<span class="number">0</span>],v6[<span class="number">3</span>]);</span><br><span class="line">	<span class="keyword">return</span> d</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_iv</span><span class="params">(iv)</span>:</span></span><br><span class="line">	out=<span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(iv)):</span><br><span class="line">		out += chr(iv[i])</span><br><span class="line">	<span class="keyword">print</span> out.encode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_unknow</span><span class="params">(plain)</span>:</span></span><br><span class="line">	text=<span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">		text+=chr(plain[i])</span><br><span class="line">	data = list(text+<span class="string">'ichunqiu'</span>*<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(<span class="number">15</span>)):</span><br><span class="line">		data[<span class="number">14</span>-i] = chr(ord(data[<span class="number">15</span>-i])^ord(data[<span class="number">14</span>-i]))</span><br><span class="line">		data[i] = chr(ord(data[i])^ord(data[i+<span class="number">16</span>]))</span><br><span class="line">	out_data=[]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">		out_data.append(ord(data[i]))</span><br><span class="line">	<span class="keyword">return</span> out_data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unknow</span><span class="params">(plain)</span>:</span></span><br><span class="line">	text=<span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">		text+=chr(plain[i])</span><br><span class="line">	data = list(text+<span class="string">'ichunqiu'</span>*<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">		data[i] = chr(ord(data[i])^ord(data[i+<span class="number">16</span>]))</span><br><span class="line">		data[<span class="number">14</span>-i] = chr(ord(data[<span class="number">15</span>-i])^ord(data[<span class="number">14</span>-i]))</span><br><span class="line">	out_data=[]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">		out_data.append(ord(data[i]))</span><br><span class="line">	<span class="keyword">return</span> out_data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span><span class="params">(iv1)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> iv1</span><br><span class="line">	iv1 = list(iv1.decode(<span class="string">'hex'</span>))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(iv1)):</span><br><span class="line">		iv1[i] = ord(iv1[i])</span><br><span class="line">	</span><br><span class="line">	tmp=[<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">	iv2=[<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			tmp[<span class="number">4</span>*i+j] = iv1[<span class="number">4</span>*j+i]</span><br><span class="line">	</span><br><span class="line">	tmp = AddRoundKey(tmp,head,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>,int_1):</span><br><span class="line">		tmp = SubBytes(tmp)</span><br><span class="line">		tmp = ShiftRows(tmp)</span><br><span class="line">		tmp = mix_columns(tmp)</span><br><span class="line">		tmp = AddRoundKey(tmp,head,k)</span><br><span class="line">		tmp = unknow(tmp)</span><br><span class="line">	tmp = SubBytes(tmp)</span><br><span class="line">	tmp = ShiftRows(tmp)</span><br><span class="line">	tmp = AddRoundKey(tmp,head,<span class="number">14</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			iv2[<span class="number">4</span>*j+i] = tmp[<span class="number">4</span>*i+j]</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(iv2)):</span><br><span class="line">		iv2[i] = chr(iv2[i])</span><br><span class="line">	</span><br><span class="line">	iv2 = <span class="string">''</span>.join(iv2)</span><br><span class="line">	iv2 = iv2.encode(<span class="string">'hex'</span>)</span><br><span class="line">	<span class="keyword">return</span> iv2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(iv1)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> iv1</span><br><span class="line">	iv1 = list(iv1.decode(<span class="string">'hex'</span>))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(iv1)):</span><br><span class="line">		iv1[i] = ord(iv1[i])</span><br><span class="line">	</span><br><span class="line">	tmp=[<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">	iv2=[<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			tmp[<span class="number">4</span>*i+j] = iv1[<span class="number">4</span>*j+i]</span><br><span class="line">	</span><br><span class="line">	tmp = AddRoundKey(tmp,head,int_1)</span><br><span class="line">	tmp = inv_ShiftRows(tmp)</span><br><span class="line">	tmp = inv_SubBytes(tmp)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> k <span class="keyword">in</span> range(int_1<span class="number">-1</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">		tmp = inv_unknow(tmp)</span><br><span class="line">		tmp = AddRoundKey(tmp,head,k)</span><br><span class="line">		tmp = inv_mix_columns(tmp)</span><br><span class="line">		tmp = inv_ShiftRows(tmp)</span><br><span class="line">		tmp = inv_SubBytes(tmp)</span><br><span class="line"></span><br><span class="line">	tmp = AddRoundKey(tmp,head,<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">			iv2[<span class="number">4</span>*j+i] = tmp[<span class="number">4</span>*i+j]</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(iv2)):</span><br><span class="line">		iv2[i] = chr(iv2[i])</span><br><span class="line">	</span><br><span class="line">	iv2 = <span class="string">''</span>.join(iv2)</span><br><span class="line">	iv2 = iv2.encode(<span class="string">'hex'</span>)</span><br><span class="line">	<span class="keyword">return</span> iv2</span><br><span class="line"></span><br><span class="line">iv1 = <span class="string">'cad3e543f23c3fec33a93f95dd8c4c2a'</span></span><br><span class="line"><span class="keyword">print</span> dec(iv1).decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure>
<p>得到我们的输入为：<code>mo4a3Ov2r5qIYgF8</code></p>
<hr>
<p>正确后，程序会打印tickets：</p>
<p><img src="http://img2.tan90.me/gadgetzan_3365d2a09163bbacd869e2e07bfb563d.png" alt=""></p>
<p>可以看出，这是一个二维码。</p>
<p>简单处理并扫描，提示我们flag为输入加上“D4wn”<br><img src="http://img2.tan90.me/gadgetzan_0c80f7c4070428f4eeb29137f1252568.png" alt=""></p>
<p><img src="http://img2.tan90.me/gadgetzan_6653524b660df35ebd791d2b2495c417.png" alt=""></p>
<p>终于得到了我们的flag:<code>mo4a3Ov2r5qIYgF8D4wn</code></p>
<p>ye~~~~</p>

      
    </div>

    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Veritas501</li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://veritas501.github.io/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/" title="2017全国大学生信息安全竞赛 re450 Gadgetzan">https://veritas501.github.io/2017/07/11/2017全国大学生信息安全竞赛_re450_Gadgetzan/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/RE/" rel="tag"># RE</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/05/一些牢骚/" rel="next" title="一些牢骚">
                <i class="fa fa-chevron-left"></i> 一些牢骚
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/25/堆入门资料/" rel="prev" title="堆入门资料">
                堆入门资料 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/215.png"
                alt="Veritas501" />
            
              <p class="site-author-name" itemprop="name">Veritas501</p>
              <p class="site-description motion-element" itemprop="description">开始踏上Re&Pwn之路...</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">65</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">38</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/veritas501" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://music.163.com/#/user/home?id=58295006" target="_blank" title="网易云"><i class="fa fa-fw fa-music"></i>网易云</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/xu-qt/activities" target="_blank" title="知乎"><i class="fa fa-fw fa-quora"></i>知乎</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://osu.ppy.sh/users/9533614" target="_blank" title="OSU"><i class="fa fa-fw fa-headphones"></i>OSU</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Veritas501</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.3.0</div>




        








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  





  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'zUGXRoho5JEFbk0lDKssrDi6-gzGzoHsz',
        appKey: 'IE9Knp7ku8I57kP5vFnPO2zA',
        placeholder: '说点什么...',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("97qzbH6lJuabRg1KDY7DtJRS-gzGzoHsz", "GS8vVhMCaeXncQF8mQOIShBj");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var newcounter = new Counter();
              /* Set ACL */
              var acl = new AV.ACL();
              acl.setPublicReadAccess(true);
              acl.setPublicWriteAccess(true);
              newcounter.setACL(acl);
              /* End Set ACL */
              newcounter.set("title", title);
              newcounter.set("url", url);
              newcounter.set("time", 1);
              newcounter.save(null, {
                success: function(newcounter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                },
                error: function(newcounter, error) {
                  console.log('Failed to create');
                }
              });
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  

  


  
  

  

  

  

  

  

</body>
</html>
